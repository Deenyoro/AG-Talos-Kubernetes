{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "packageRules": [
    // NOTE: Renovate processes rules from top to bottom, so the rules below take precedence over rules above it
    {
      "description": "Separate all app-template updates",
      "matchPackageNames": ["**app-template"],
      "matchDatasources": ["helm", "docker"],
      "semanticCommitScope": "helm/app-template",
      "separateMajorMinor": true,
      "separateMultipleMajor": true,
      "separateMinorPatch": true,
      "additionalBranchPrefix": "{{ currentVersion }}-to-"
    },
    {
      "description": "Manually approve app-template major releases",
      "matchPackageNames": ["**app-template"],
      "matchDatasources": ["helm", "docker"],
      "matchUpdateTypes": ["major"],
      "dependencyDashboardApproval": true,
      "automerge": false,
      "groupName": "app-template-major"
    },
    {
      "description": "Auto merge patch app-template versions",
      "matchPackageNames": ["**app-template"],
      "matchDatasources": ["helm", "docker"],
      "matchUpdateTypes": ["patch"],
      "dependencyDashboardApproval": false,
      "automerge": true,
      "automergeType": "pr",
      "rebaseWhen": "behind-base-branch",
      "groupName": "app-template-patch"
    },
    {
      "description": "Don't automerge app-template minor releases",
      "matchPackageNames": ["**app-template"],
      "matchDatasources": ["helm", "docker"],
      "matchUpdateTypes": ["minor"],
      "dependencyDashboardApproval": false,
      "automerge": false,
      "groupName": "app-template-minor"
    },
    {
      "description": "Flux Group",
      "groupName": "Flux",
      "matchPackagePatterns": ["flux"],
      "matchDatasources": ["docker", "github-tags"],
      "versioning": "semver",
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      },
      "separateMinorPatch": true
    },
    {
      "description": "authentik Group",
      "groupName": "authentik",
      "matchPackageNames": ["**authentik**", "ghcr.io/goauthentik/**"],
      "versioning": "semver-coerced",
      "sourceUrl": "https://github.com/goauthentik/authentik",
      //"prBodyNotes": "Changelog link: https://docs.goauthentik.io/docs/releases/{{newMajor}}.{{newMinor}}#fixed-in-{{newMajor}}{{newMinor}}{{newPatch}}",
      "automerge": false,
      "separateMultipleMajor": true,
      "separateMinorPatch": true
    },
    {
      "description": "Rook-Ceph image and chart",
      "groupName": "Rook-Ceph",
      "matchPackagePatterns": ["rook.ceph"],
      "matchDatasources": ["docker", "helm"],
      "group": { "commitMessageTopic": "{{{groupName}}} group" },
      "separateMinorPatch": true
    },
    {
      "description": "Immich images",
      "groupName": "Immich",
      "matchPackagePatterns": ["immich"],
      "matchDatasources": ["docker"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      },
      "separateMinorPatch": true
    },
    {
      "description": "intel-device-plugin images",
      "groupName": "intel-device-plugins",
      "matchPackagePatterns": ["intel-device-plugins-operator","intel-device-plugins-gpu"],
      "matchDatasources": ["helm"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      }
    },
    {
      "description": "mariadb",
      "groupName": "mariadb-operator",
      "matchPackagePatterns": ["mariadb-operator-crds", "mariadb-operator"],
      "matchDatasources": ["docker", "helm"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      }
    },
    {
      "description": "Wazuh images",
      "groupName": "Wazuh",
      "matchPackagePatterns": ["wazuh"],
      "matchDatasources": ["docker"],
      "group": {
        "commitMessageTopic": "{{{groupName}}} group"
      }
    },
    {
      "description": "authentik Group",
      "groupName": "authentik",
      "matchPackageNames": ["**authentik**", "ghcr.io/goauthentik/**"],
      "versioning": "semver-coerced",
      "sourceUrl": "https://github.com/goauthentik/authentik",
      //"prBodyNotes": "Changelog link: https://docs.goauthentik.io/docs/releases/{{newMajor}}.{{newMinor}}#fixed-in-{{newMajor}}{{newMinor}}{{newPatch}}",
      "automerge": false,
      "separateMultipleMajor": true,
      "separateMinorPatch": true
    },
    {
      "description": "1Password Group",
      "groupName": "1Password",
      "matchPackageNames": ["**1password**"],
      "versioning": "semver"
    },
    {
      "description": "Talos",
      "groupName": "Talos",
      "matchPackageNames": ["**siderolabs/installer", "**siderolabs/talos"],
      "overrideDepName": "{{{ replace 'installer' 'talos' depName }}}",
      "versioning": "semver",
      "automerge": false
    },
    {
      "description": "Kubernetes Group",
      "groupName": "Kubernetes",
      "matchPackageNames": ["**kubelet", "**kubectl", "**kube-apiserver"],
      "versioning": "semver",
      "automerge": false
    }
  ]
}
